# 🧐 메모리 구조란?
운영체제는 프로그램의 실행을 위해 다양한 메모리 공간을 제공  
프로그램이 운영체제로부터 할당 받는 대표적인 메모리 공간  
<br>

## 🗂 코드(Code) 영역
- 우리가 작성한 소스 코드가 들어가는 영역이다.
- 즉, **실행할 프로그램의 코드가 저장**되는 영역이다.
- 한마디로 명령문들이 저장되는 것인데, 제어문, 함수, 상수들이 이 영역에 저장된다. 
- 텍스트 영역이라고도 부른다.  
<br>

## 🗂 데이터(Data) 영역
- **전역변수, 정적변수, static**이 할당되는 영역이다.
- 프로그램의 시작과 동시에 할당되고, 프로그램이 종료되어야 메모리가 소멸되는 영역이다.  
- 좀 더 구체적으로 보면 데이터 영역 안에서도 두 영역으로 나뉜다.  
<br>

### GVAR
- 범위가 정해지지 않은 전역 변수가 할당
### BSS
- 초기값을 0이 아닌 특정한 값(초기화되지 않은 변수)으로 지정한 경우 사용
<br>

## 🗂 힙(Heap) 영역
- **사용자가 관리해야 하는 영역**이다.
- 흔히 **동적으로 할당** 할 변수들이 여기에 저장된다고 생각하면 된다.
- 또한 Java나 C++에서 new 연산자로 생성하는 경우 또는 class, 참조 변수들도 Heap영역에 들어가게 된다.
- 간단히, 사용자에 의해 메모리 공간이 동적으로 할당되고 해제되는 공간이다.
- 런타임때 메모리를 할당 받는 것을 메모리에 동적 할당한다고 한다.
- 그리고 Heap 영역은 대개 낮은 주소에서 높은 주소로 할당(적재)된다.  
<br>

### 힙의 장점
- 프로그램에 필요한 개체의 개수가 크기를 미리 알 수 없는 경우에 사용 가능하다.
- 개체가 너무 커서 스택 할당자에 맞지 않는 경우 사용 가능하다.
### 힙의 단점
- 할당과 해제의 작업으로 인해 속도가 저하된다.  
<br>

## 🗂 스택(Stack) 영역
- **지역변수, 매개변수**들이 저장되는 영역이다.
- 때문에 함수의 시작과 함꼐 할당되며, 함수가 종료되면 해당 함수에 할당된 변수들을 메모리에서 해제시킨다.
- Stack 자료구조의 pop과 같은 기능이다.(LIFO)
- 재귀함수를 호출할 때, 재귀가 깊어지면 Stack Overflow 가 나게 된다.  
재귀를 반복적으로 호출하면 Stack 메모리 영역에 해당 함수의 지역변수, 매개변수들이 계속 할당되다가 OS에서 할당해준 Stack영역의 메모리 영역을 넘어버려 발생하게 되는 것이다.
- Stack영역은 Heap영역과 반대로 높은주소에서 낮은주소로 메모리에 할당(적재)됩니다.  
<br>

### 스택의 장점
- 낭비되는 공간이 없다.
- 하나의 명령만으로 메모리 조작과 어드레스 조작이 가능하다.
### 스택의 단점
- 한계가 있어 한계를 초과하도록 삽입할 수 없다.
- 유연성이 부족하다.  
<br>

## 동적 할당과 정정 할당
- 정적 할당은 카페 한테이블에 어떤 손님이 앉아있다 나갔지만 그 테이블은 카페가 문을 닫을 때까지 계속 사용할 수 없는 자리로 남는 것이다.
- 동적 할당은 손님이 앉아있다 나가면 다른 사람이 그 자리를 사용할 수 있는 것이다.  
<br>

## Buffer Overflow
- 스택에 적재되면 스택의 처음 주소값을 시작으로 점차 작은 주소값으로 저장되고,
- 반대로 힙은 힙의 처음 주소값을 기준으로 점차 큰 주소값으로 저장된다.
- 이런 식의 차이점을 두는 가장 큰 이유는 Buffer Overflow를 막기 위해서이다.
- 버퍼 오버플로우는 이전에는 변수에 스택 영역이 초과되는 크기의 데이터를 저장하여, 스택보다 더 높은 주소에 있는 커널 영역에 침범해 데이터를 조작하여 관리자 권한 같은 것이 해킹 됐었다.
- 이를 방지하기 위해 커널 영역보다 작고 스택에서는 가장 큰 숫자부터 내려오도록 적재하여 커널 영역을 침범하지 않도록 한 것이다.  
<br>

## ✅ 요약
스택이 빠르다!  
<br>
스택은 이미 할당되어 있는 공간을 사용하는 것이고, 힙은 사용자가 따로 동적으로 할당해서 사용하는 공간이기 때문이다.  
다만 스택은 공간이 매우 작기 때문에 모든 응용에서 스택을 사용할 수는 없다.  
<br>

## 🟡 JS에서 힙과 스택
- Stack은 immutable 데이터가 저장되는 곳
- Heap은 mutable 데이터가 저장되는 곳  

숫자, 문자열, boolean, null, undefined, Symbol과 같은 **원시 타입들은 Stack에** 저장되고,  
객체, 배열, Set, 함수와 같은 **참조 타입은 Heap에** 저장된다.  
<br>

## 가비지 컬렉션(Garbage Collection)
JS에서는 가비지 컬렉션이라는 **자동 메모리 관리** 형식을 활용한다.  
가비지 콜렉터의 목적은 메모리 할당을 모니터링하고,  
할당된 메모리의 블록이 더 이상 필요하지 않은 시점을 확인하여 회수하는 것이다.  
<br>

## Reference
[https://st-lab.tistory.com/198](https://st-lab.tistory.com/198)  
[https://www.youtube.com/watch?v=uDZCfiCYfsU](https://www.youtube.com/watch?v=uDZCfiCYfsU)  
[https://www.youtube.com/watch?v=xjHQLXsSMkY](https://www.youtube.com/watch?v=xjHQLXsSMkY)  
<br>
<br>

# JS의 메모리 관리
// TODO  
<br>

## Reference
[https://yceffort.kr/2020/11/nodejs-best-pratices-for-performance](https://yceffort.kr/2020/11/nodejs-best-pratices-for-performance)
# 📖 용어 정리
- 프로그램  
    - 어떤 작업을 위해 운영체제 위에서 실행할 수 있는 파일  
    - ex) 웹 브라우저, 워드 프로세서, 카카오톡 등
- 프로세스  
    - 운영 체제 위에서 **실행 중**인 프로그램  
    - 프로그램 명령어와 데이터들이 메모리에 올라오고 실행 중 또는 실행 대기 중인 상태
- 프로세서  
    - 프로세스가 동작될 수 있도록 하는 하드웨어(**CPU**)  
    - 프로그램의 자원들이 메모리에 올라오고, 실행되어야 할 코드의 메모리 주소를 CPU의 레지스터로 올려준다.
  
👉 프로그램은 저장장치에 있는 정적 상태, 프로세스는 실행을 위해 메모리에 올라가는 동적 상태  
<br>
<br>

# 메모리 구조
운영체제는 프로그램의 실행을 위해 다양한 메모리 공간을 제공  
프로그램이 운영체제로부터 할당 받는 대표적인 메모리 공간  
<img width="1000" src="https://user-images.githubusercontent.com/17706346/152528899-85e58205-06d7-4ab6-83bf-4efd0f63d3b1.png">  
<br>

## 🗂 코드(Code, TEXT) 영역
- 우리가 작성한 소스 코드가 들어가는 영역이다.
- 즉, **실행할 프로그램의 코드가 저장**되는 영역이다.
- 한마디로 명령문들이 저장되는 것인데, 제어문, 함수, 상수들이 이 영역에 저장된다. 
- 텍스트 영역이라고도 부른다.  
<br>

## 🗂 데이터(Data) 영역
- **전역변수, 정적변수, static**이 할당되는 영역이다.
- 프로그램의 시작과 동시에 할당되고, 프로그램이 종료되어야 메모리에서 소멸되는 영역이다.  
- 좀 더 구체적으로 보면 데이터 영역 안에서도 두 영역으로 나뉜다.
### GVAR
- 범위가 정해지지 않은 전역 변수가 할당
### BSS
- 초기값을 0이 아닌 특정한 값(초기화되지 않은 변수)으로 지정한 경우 사용  
<br>

## 🗂 힙(Heap) 영역
- 흔히 **동적으로 할당** 할 변수들이 여기에 저장된다고 생각하면 된다.
- 간단히, 사용자에 의해 메모리 공간이 동적으로 할당되고 해제되는 공간이다.  
그러나 JS에서는 가비지 컬렉터가 해제를 해준다.
<img width="1000" src="https://user-images.githubusercontent.com/17706346/152529660-b74092bc-df53-4a25-b6d7-93e7b9d65585.png">
- Stack 영역이 클 수록 Heap 영역이 작아지고 Heap 영역이 클수록 Stack 영역이 작아진다.  

- 또한 Java나 C++에서 new 연산자로 생성하는 경우 또는 class, 참조 변수들도 Heap영역에 들어가게 된다.
- 이 영역에 데이터를 저장하기 위해 c는 malloc(), c++은 new() 함수를 사용한다.
- malloc() 함수는
    - 프로그램이 실행중 일때 사용자가 직접 힙 영역에 메모리 할당을 할 수 있게 해준다.
    - 인수로 할당받고자 하는 메모리의 크기를 바이트 단위로 전달받는다. 그리고 전달받은 메모리 크기에 맞고 아직 할당되지 않은 적당한 블록을 찾는다. 이렇게 찾은 블록의 첫번째 바이트를 가리키는 주소를 반환한다.
    - 힙 영역에 할당할 수 있는 적당한 블록이 없으면 null point 반환한다.  
<img width="1000" src="https://user-images.githubusercontent.com/17706346/152528958-9e1edcb7-d95c-44ca-80ea-2fc00164ee8c.png">

- free() 또는 delete를 통해 해제가 가능하다.
- 런타임때 메모리를 할당 받는 것을 메모리에 동적 할당한다고 한다.
- Heap 영역은 대개 **낮은 주소에서 높은 주소로 할당**(적재)된다.  
<br>

### 힙의 장점
- 프로그램에 필요한 개체의 개수가 크기를 미리 알 수 없는 경우에 사용 가능하다.
- 개체가 너무 커서 스택 할당자에 맞지 않는 경우 사용 가능하다.
### 힙의 단점
- 할당과 해제의 작업으로 인해 속도가 저하된다.  
<br>

## 🗂 스택(Stack) 영역
- **지역변수, 매개변수, 리턴값** 등 잠시 사용되었다가 사라지는 데이터를 저장하는 영역이다.
- 때문에 함수의 시작과 함꼐 할당되며, 함수가 종료되면 해당 함수에 할당된 변수들을 메모리에서 해제시킨다.
- Stack 자료구조의 pop과 같은 기능이다.(LIFO)  
- Stack은 변수 단위로 하나씩이 아니라 stack frame 단위로 쌓인다.  
즉, 함수가 실행될 때마다 stack frame 전체 하나가 쌓이는 것이다.  
<img width="1000" src="https://user-images.githubusercontent.com/17706346/152535242-d505346d-d56d-4d75-a436-0fed4946760b.png">

- 스택에는 값이 저장되는 것이 아니라 포인터가 쌓인다.
<img width="1000" src="https://user-images.githubusercontent.com/17706346/152550434-9f301313-4bc7-4d7e-a9d7-99977d7cb711.png">

- 재귀함수를 호출할 때, 재귀가 깊어지면 Stack Overflow 가 나게 된다.  
재귀를 반복적으로 호출하면 Stack 메모리 영역에 해당 함수의 지역변수, 매개변수들이 계속 할당되다가  
OS에서 할당해준 Stack영역의 메모리 영역을 넘어버려 발생하게 되는 것이다.
- Stack영역은 Heap영역과 반대로 **높은 주소에서 낮은 주소로 메모리에 할당**(적재)됩니다.  
<br>

### 스택의 장점
- 낭비되는 공간이 없다.
- 하나의 명령만으로 메모리 조작과 어드레스 조작이 가능하다.
### 스택의 단점
- 한계가 있어 한계를 초과하도록 삽입할 수 없다.
- 유연성이 부족하다.  
<br>

## ✅ 요약
*스택이 빠르다!*  
스택은 이미 할당되어 있는 공간을 사용하는 것이고, 힙은 사용자가 따로 동적으로 할당해서 사용하는 공간이기 때문이다.  
다만 스택은 공간이 매우 작기 때문에 모든 응용에서 스택을 사용할 수는 없다.  
<br>
<br>

# 메모리 주소
- 32bit, 64bit 이 둘의 차이점은 비트의 너비이다.  
- 32개의 비트는 2^32, 64비트는 2^64. 데이터 처리 단위이다.  
- 메모리 한칸은 1바이트(=8비트), 32bit 운영체제는 4바이트 길이 주소 갖게 된다. (0x0000000 ~ 0xFFFFFFFF)  
이에 비해 64bit 운영체제는 8바이트 길이 주소 갖게 된다. (0x0000000000000000 ~ 0xFFFFFFFFFFFFFFFF)  
<br>
<br>

# 동적 할당과 정정 할당
- 정적 할당은 카페 한테이블에 어떤 손님이 앉아있다 나갔지만 그 테이블은 카페가 문을 닫을 때까지 계속 사용할 수 없는 자리로 남는 것이다.
- 동적 할당은 손님이 앉아있다 나가면 다른 사람이 그 자리를 사용할 수 있는 것이다.  
<br>
<br>

# Buffer Overflow
- 스택에 적재되면 스택의 처음 주소값을 시작으로 점차 작은 주소값으로 저장되고,
- 반대로 힙은 힙의 처음 주소값을 기준으로 점차 큰 주소값으로 저장된다.
- 이런 식의 차이점을 두는 가장 큰 이유는 Buffer Overflow를 막기 위해서이다.
- 버퍼 오버플로우는 이전에는 변수에 스택 영역이 초과되는 크기의 데이터를 저장하여, 스택보다 더 높은 주소에 있는 커널 영역에 침범해 데이터를 조작하여 관리자 권한 같은 것이 해킹됐었다.
- 이를 방지하기 위해 커널 영역보다 작고 스택에서는 가장 큰 숫자부터 내려오도록 적재하여 커널 영역을 침범하지 않도록 한 것이다.  
<br>
<br>

# 가비지 컬렉션(Garbage Collection)
- JS에서는 가비지 컬렉션이라는 **자동 메모리 관리** 형식을 활용한다.  
- 가비지 콜렉터의 목적은 메모리 할당을 모니터링하고,  
할당된 메모리의 블록이 더 이상 필요하지 않은 시점을 확인하여 회수하는 것이다.  
<br>
<br>

# JS에서 힙과 스택
- Stack은 immutable 데이터가 저장되는 곳
- Heap은 mutable 데이터가 저장되는 곳  
- 숫자, 문자열, boolean, null, undefined, Symbol과 같은 **원시 타입들은 Stack에** 저장되고,  
객체, 배열, Set, 함수와 같은 **참조 타입은 Heap에** 저장된다.  
<br>

## Reference
[https://st-lab.tistory.com/198](https://st-lab.tistory.com/198)  
[https://www.youtube.com/watch?v=uDZCfiCYfsU](https://www.youtube.com/watch?v=uDZCfiCYfsU)  
[https://www.youtube.com/watch?v=xjHQLXsSMkY](https://www.youtube.com/watch?v=xjHQLXsSMkY)  
[https://velog.io/@becolorful/TIL-%ED%95%99%EC%8A%B5%EC%A0%95%EB%A6%AC-170122](https://velog.io/@becolorful/TIL-%ED%95%99%EC%8A%B5%EC%A0%95%EB%A6%AC-170122)  
  
[https://charming-kyu.tistory.com/19](https://charming-kyu.tistory.com/19)  
<br>
<br>

# JS의 메모리 관리
[https://yceffort.kr/2020/11/nodejs-best-pratices-for-performance](https://yceffort.kr/2020/11/nodejs-best-pratices-for-performance)